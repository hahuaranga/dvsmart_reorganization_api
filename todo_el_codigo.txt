════════════════════════════════════════════════
ARCHIVO: ./pom.xml
════════════════════════════════════════════════
<project xmlns="http://maven.apache.org/POM/4.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>4.0.0</version>
	</parent>
	<groupId>com.indra.minsait.dvsmart.reorganization</groupId>
	<artifactId>dvsmart_reorganization_api</artifactId>
	<version>1.0.1-SNAPSHOT</version>
	<name>dvsmart_reorganization_api</name>
	<properties>
		<java.version>21</java.version>
		<maven.compiler.source>21</maven.compiler.source>
		<maven.compiler.target>21</maven.compiler.target>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>

		<license.maven.plugin.version>5.0.0</license.maven.plugin.version>
		<maven.build.timestamp.format>yyyy</maven.build.timestamp.format>

		<spring-batch.version>6.0.0</spring-batch.version>
		<spring-integration.version>7.0.0</spring-integration.version>

		<!-- Other dependencies -->
		<lombok.version>1.18.30</lombok.version>
		<sshj.version>0.38.0</sshj.version>
	</properties>

	<dependencies>
		<!-- Spring Boot Starters -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-data-mongodb</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-actuator</artifactId>
		</dependency>

		<!-- Spring Batch -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-batch</artifactId>
		</dependency>

		<!-- Spring Integration Core -->
		<dependency>
			<groupId>org.springframework.integration</groupId>
			<artifactId>spring-integration-core</artifactId>
		</dependency>

		<!-- Spring Integration SFTP (SSHJ) -->
		<dependency>
			<groupId>org.springframework.integration</groupId>
			<artifactId>spring-integration-sftp</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework.batch</groupId>
			<artifactId>spring-batch-integration</artifactId>
		</dependency>

		<!-- SSHJ for SFTP -->
		<dependency>
			<groupId>com.hierynomus</groupId>
			<artifactId>sshj</artifactId>
			<version>${sshj.version}</version>
		</dependency>

		<!-- Lombok -->
		<dependency>
			<groupId>org.projectlombok</groupId>
			<artifactId>lombok</artifactId>
			<scope>provided</scope>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-devtools</artifactId>
			<scope>runtime</scope>
			<optional>true</optional>
		</dependency>

		<!-- Spring Boot Configuration Processor -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-configuration-processor</artifactId>
			<optional>true</optional>
		</dependency>
		
		<dependency>
		    <groupId>com.h2database</groupId>
		    <artifactId>h2</artifactId>
		    <scope>runtime</scope>
		</dependency>		

		<!-- Testing -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>

		<dependency>
			<groupId>org.springframework.batch</groupId>
			<artifactId>spring-batch-test</artifactId>
			<scope>test</scope>
		</dependency>

		<dependency>
			<groupId>org.springframework.integration</groupId>
			<artifactId>spring-integration-test</artifactId>
			<scope>test</scope>
		</dependency>
	</dependencies>

	<build>
		<finalName>${project.artifactId}</finalName>
		<plugins>

			<!-- Maven Compiler Plugin -->
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-compiler-plugin</artifactId>
				<configuration>
					<source>${java.version}</source>
					<target>${java.version}</target>
					<encoding>${project.build.sourceEncoding}</encoding>
					<annotationProcessorPaths>
						<path>
							<groupId>org.projectlombok</groupId>
							<artifactId>lombok</artifactId>
							<version>${lombok.version}</version>
						</path>
						<path>
							<groupId>org.springframework.boot</groupId>
							<artifactId>spring-boot-configuration-processor</artifactId>
							<version>4.0.0</version>
						</path>
					</annotationProcessorPaths>
				</configuration>
			</plugin>

			<!-- Spring Boot Maven Plugin -->
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
				<configuration>
					<excludes>
						<exclude>
							<groupId>org.projectlombok</groupId>
							<artifactId>lombok</artifactId>
						</exclude>
					</excludes>
				</configuration>
				<executions>
					<execution>
						<goals>
							<goal>repackage</goal>
						</goals>
					</execution>
				</executions>
			</plugin>

			<!-- CopyRight Plugin -->
			<plugin>
				<groupId>com.mycila</groupId>
				<artifactId>license-maven-plugin</artifactId>
				<version>${license.maven.plugin.version}</version>
				<configuration>
					<!-- Ruta del banner -->
					<header>src/main/resources/license-header.txt</header>

					<!-- Aplicar solo a archivos donde corresponde -->
					<includes>
						<include>**/*.java</include>
					</includes>

					<!-- Evitar modificar código generado o configuraciones -->
					<excludes>
						<exclude>**/target/**</exclude>
						<exclude>**/generated/**</exclude>
					</excludes>

					<!-- Variables dinámicas -->
					<properties>
						<year>${maven.build.timestamp}</year>
					</properties>

					<!-- Etiquetas conocidas para insertar correctamente el
					header -->
					<mapping>
						<java>SLASHSTAR_STYLE</java>
					</mapping>

					<!-- Configuraciones adicionales importantes -->
					<strictCheck>true</strictCheck>
					<useDefaultExcludes>true</useDefaultExcludes>
				</configuration>

				<executions>
					<!-- Ejecuta el format en la fase process-sources (antes de
					compile) -->
					<execution>
						<id>apply-license-headers</id>
						<phase>process-sources</phase>
						<goals>
							<goal>format</goal>
						</goals>
					</execution>
				</executions>
			</plugin>

			<!-- Maven Surefire Plugin (para tests) -->
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-surefire-plugin</artifactId>
				<!--				<version>3.0.0</version>-->
				<configuration>
					<includes>
						<include>**/*Test.java</include>
						<include>**/*Tests.java</include>
					</includes>
				</configuration>
			</plugin>

			<!-- Maven Resources Plugin -->
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-resources-plugin</artifactId>
				<!--				<version>3.3.1</version>-->
				<configuration>
					<encoding>${project.build.sourceEncoding}</encoding>
				</configuration>
			</plugin>
		</plugins>
	</build>

	<!-- Profiles -->
	<profiles>
		<!-- Development Profile -->
		<profile>
			<id>dev</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<properties>
				<spring.profiles.active>dev</spring.profiles.active>
			</properties>
		</profile>

		<!-- Production Profile -->
		<profile>
			<id>prod</id>
			<properties>
				<spring.profiles.active>prod</spring.profiles.active>
			</properties>
		</profile>
	</profiles>
</project>-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/adapter/in/web/BatchReorganizeController.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.adapter.in.web;

import com.indra.minsait.dvsmart.reorganization.application.port.in.StartReorganizeFullUseCase;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import java.util.Map;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 13:25:04
 * File: BatchReorganizeController.java
 */

@Slf4j
@RestController
@RequestMapping("/api/batch/reorganize")
@RequiredArgsConstructor
public class BatchReorganizeController {

    private final StartReorganizeFullUseCase startReorganizeFullUseCase;

    @PostMapping("/full")
    public ResponseEntity<Map<String, Object>> startFullReorganization() {
        log.info("Received request to start full reorganization");
        
        Long jobExecutionId = startReorganizeFullUseCase.execute();
        
        return ResponseEntity.accepted()
                .body(Map.of(
                    "message", "Batch job started successfully",
                    "jobExecutionId", jobExecutionId,
                    "status", "ACCEPTED"
                ));
    }
}-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/adapter/out/batch/config/BatchReorgFullConfig.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.adapter.out.batch.config;

import com.indra.minsait.dvsmart.reorganization.adapter.out.batch.reader.MongoIndexedDisorganizedFileItemReader;
import com.indra.minsait.dvsmart.reorganization.adapter.out.batch.writter.SftpMoveAndIndexItemWriter;
import com.indra.minsait.dvsmart.reorganization.adapter.out.persistence.mongodb.entity.DisorganizedFilesIndexDocument;
import com.indra.minsait.dvsmart.reorganization.domain.model.ArchivoLegacy;
import com.indra.minsait.dvsmart.reorganization.domain.service.FileReorganizationService;
import com.indra.minsait.dvsmart.reorganization.infrastructure.config.BatchConfigProperties;
import com.indra.minsait.dvsmart.reorganization.infrastructure.config.SftpConfigProperties;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.batch.core.configuration.JobRegistry;
import org.springframework.batch.core.configuration.support.MapJobRegistry;
import org.springframework.batch.core.job.Job;
import org.springframework.batch.core.job.builder.JobBuilder;
import org.springframework.batch.core.repository.JobRepository;
import org.springframework.batch.core.step.Step;
import org.springframework.batch.core.step.builder.StepBuilder;
import org.springframework.batch.infrastructure.item.ItemProcessor;
import org.springframework.batch.infrastructure.item.data.MongoCursorItemReader;
import org.springframework.batch.infrastructure.item.support.CompositeItemProcessor;
import org.springframework.batch.integration.async.AsyncItemProcessor;
import org.springframework.batch.integration.async.AsyncItemWriter;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.task.TaskExecutor;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;
import java.util.Arrays;
import java.util.concurrent.Future;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 13:23:54
 * File: BatchReorgFullConfig.java
 */

@Slf4j
@Configuration
@RequiredArgsConstructor
public class BatchReorgFullConfig {

    private final JobRepository jobRepository;
    private final MongoIndexedDisorganizedFileItemReader mongoReader;
    private final SftpMoveAndIndexItemWriter sftpWriter;
    private final FileReorganizationService reorganizationService;
    private final SftpConfigProperties sftpProps;
    private final BatchConfigProperties batchProps;

    // ========================================================================
    // NUEVOS BEANS AGREGADOS PARA JobOperator
    // ========================================================================
    
    /**
     * JobRegistry para que JobOperator pueda encontrar jobs por nombre.
     * Sin este bean, JobOperator lanzará NoSuchJobException.
     */
    @Bean
    JobRegistry jobRegistry() {
        return new MapJobRegistry();
    }

    // ========================================================================
    // BEANS EXISTENTES (SIN CAMBIOS)
    // ========================================================================

    @Bean(name = "batchTaskExecutor")
    TaskExecutor batchTaskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(batchProps.getThreadPoolSize());
        executor.setMaxPoolSize(batchProps.getThreadPoolSize());
        executor.setQueueCapacity(batchProps.getQueueCapacity());
        executor.setThreadNamePrefix("batch-reorg-async-");
        executor.setWaitForTasksToCompleteOnShutdown(true);
        executor.setAwaitTerminationSeconds(60);
        executor.initialize();
        return executor;
    }

    /**
     * Reader con cursor streaming
     * Usa MongoCursorItemReader para millones de registros
     */
    @Bean
    MongoCursorItemReader<DisorganizedFilesIndexDocument> archivoIndexReader() {
        return mongoReader.createReader();
    }

    /**
     * Processor 1: Convierte Document MongoDB → ArchivoLegacy
     */
    @Bean
    ItemProcessor<DisorganizedFilesIndexDocument, ArchivoLegacy> documentToLegacyProcessor() {
        return doc -> {
            if (doc == null) {
                return null;
            }
            return ArchivoLegacy.builder()
                    .idUnico(doc.getIdUnico())
                    .rutaOrigen(doc.getRutaOrigen())
                    .nombre(doc.getNombre())
                    .mtime(doc.getMtime())
                    .build();
        };
    }

    /**
     * Processor 2: Calcula hash partition (SHA-256)
     */
    @Bean
    ItemProcessor<ArchivoLegacy, ArchivoLegacy> hashPartitionProcessor() {
        return archivo -> {
            if (archivo == null) {
                return null;
            }
            String destPath = reorganizationService.calculateDestinationPath(
                archivo, sftpProps.getDest().getBaseDir());
            log.trace("Calculated destination: {} -> {}", archivo.getRutaOrigen(), destPath);
            return archivo;
        };
    }

    /**
     * Composite Processor: Combina Document→Legacy + Hash
     */
    @Bean
    CompositeItemProcessor<DisorganizedFilesIndexDocument, ArchivoLegacy> compositeProcessor() {
        CompositeItemProcessor<DisorganizedFilesIndexDocument, ArchivoLegacy> processor = new CompositeItemProcessor<>();
        processor.setDelegates(Arrays.asList(
            documentToLegacyProcessor(),
            hashPartitionProcessor()
        ));
        return processor;
    }

    /**
     * Async Processor para procesamiento paralelo
     */
    @Bean
    AsyncItemProcessor<DisorganizedFilesIndexDocument, ArchivoLegacy> asyncProcessor() {
        AsyncItemProcessor<DisorganizedFilesIndexDocument, ArchivoLegacy> asyncProcessor = 
            new AsyncItemProcessor<DisorganizedFilesIndexDocument, ArchivoLegacy>(compositeProcessor());
        asyncProcessor.setTaskExecutor(batchTaskExecutor());
        return asyncProcessor;
    }

    /**
     * Async Writer para escritura paralela
     */
    @Bean
    AsyncItemWriter<ArchivoLegacy> asyncWriter() {
        AsyncItemWriter<ArchivoLegacy> asyncWriter = new AsyncItemWriter<>(sftpWriter);
        return asyncWriter;
    }

    /**
     * Step principal con chunk-oriented processing
     */
    @Bean
    Step reorganizeStep() {
        return new StepBuilder("reorganizeStep", jobRepository)
                .<DisorganizedFilesIndexDocument, Future<ArchivoLegacy>>chunk(batchProps.getChunkSize())
                .reader(archivoIndexReader())
                .processor(asyncProcessor())
                .writer(asyncWriter())
                .build();
    }

    /**
     * Job completo de reorganización.
     * IMPORTANTE: El nombre "BATCH-REORG-FULL" debe coincidir con el usado en JobOperator.start()
     */
    @Bean(name = "batchReorgFullJob")
    Job batchReorgFullJob() {
        return new JobBuilder("BATCH-REORG-FULL", jobRepository)
                .start(reorganizeStep())
                .build();
    }
}-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/adapter/out/batch/reader/MongoIndexedDisorganizedFileItemReader.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.adapter.out.batch.reader;

import com.indra.minsait.dvsmart.reorganization.adapter.out.persistence.mongodb.entity.DisorganizedFilesIndexDocument;
import com.indra.minsait.dvsmart.reorganization.infrastructure.config.MongoConfigProperties;

import lombok.RequiredArgsConstructor;
import org.bson.Document;
import org.springframework.batch.infrastructure.item.data.MongoCursorItemReader;
import org.springframework.batch.infrastructure.item.data.builder.MongoCursorItemReaderBuilder;
import org.springframework.data.domain.Sort;
import org.springframework.data.mongodb.core.MongoTemplate;
import org.springframework.stereotype.Component;
import java.util.HashMap;
import java.util.Map;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 13:21:00
 * File: MongoIndexedFileItemReader.java
 */

/**
 * Reader que utiliza cursor streaming de MongoDB para leer millones de archivos
 * sin cargar todo en memoria ni usar skip() que es lento.
 */
@Component
@RequiredArgsConstructor
public class MongoIndexedDisorganizedFileItemReader {

    private final MongoTemplate mongoTemplate;
    
    private final MongoConfigProperties properties; 

    /**
     * Crea un MongoCursorItemReader para streaming eficiente
     * 
     * @return MongoCursorItemReader configurado
     */
    public MongoCursorItemReader<DisorganizedFilesIndexDocument> createReader() {
        // Query vacía = todos los documentos
        Document query = new Document();
        
        // Sort por _id para orden consistente y uso de índice
        Map<String, Sort.Direction> sorts = new HashMap<>();
        sorts.put("_id", Sort.Direction.ASC);
        
        return new MongoCursorItemReaderBuilder<DisorganizedFilesIndexDocument>()
                .name("archivoIndexCursorReader")
                .template(mongoTemplate)
                .jsonQuery(query.toJson())
                .targetType(DisorganizedFilesIndexDocument.class)
                .sorts(sorts)
                .collection(properties.getDisorganizedFilesIndex())
                .batchSize(100) // Tamaño del batch interno del cursor
                .saveState(true) // Permite restart del job
                .build();
    }
}-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/adapter/out/batch/writter/SftpMoveAndIndexItemWriter.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.adapter.out.batch.writter;

import com.indra.minsait.dvsmart.reorganization.application.port.out.OrganizedFilesIndexRepository;
import com.indra.minsait.dvsmart.reorganization.application.port.out.SftpDestinationRepository;
import com.indra.minsait.dvsmart.reorganization.application.port.out.SftpOriginRepository;
import com.indra.minsait.dvsmart.reorganization.domain.model.ArchivoLegacy;
import com.indra.minsait.dvsmart.reorganization.domain.model.ProcessedArchivo;
import com.indra.minsait.dvsmart.reorganization.domain.service.FileReorganizationService;
import com.indra.minsait.dvsmart.reorganization.infrastructure.config.SftpConfigProperties;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.batch.infrastructure.item.Chunk;
import org.springframework.batch.infrastructure.item.ItemWriter;
import org.springframework.stereotype.Component;
import java.io.InputStream;
import java.time.Instant;
import java.util.ArrayList;
import java.util.List;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 13:22:10
 * File: SftpMoveAndAuditItemWriter.java
 */

@Slf4j
@Component
@RequiredArgsConstructor
public class SftpMoveAndIndexItemWriter implements ItemWriter<ArchivoLegacy> {

    private final SftpOriginRepository originRepo;
    private final SftpDestinationRepository destRepo;
    private final OrganizedFilesIndexRepository indexingRepo;
    private final FileReorganizationService reorganizationService;
    private final SftpConfigProperties props;

    @Override
    public void write(Chunk<? extends ArchivoLegacy> chunk) {
        List<ProcessedArchivo> indexingRecords = new ArrayList<>();
        
        for (ArchivoLegacy archivo : chunk) {
            ProcessedArchivo audit = processFile(archivo);
            indexingRecords.add(audit);
        }
        
        if (!indexingRecords.isEmpty()) {
            indexingRepo.saveAll(indexingRecords);
        }
    }

    private ProcessedArchivo processFile(ArchivoLegacy archivo) {
        String destinationPath = reorganizationService.calculateDestinationPath(
            archivo, props.getDest().getBaseDir());
        
        try (InputStream in = originRepo.readFile(archivo.getRutaOrigen())) {
            
            // Transferencia streaming directa (crea dirs internamente)
            destRepo.transferTo(destinationPath, in);
            
            log.debug("Successfully transferred: {} -> {}", archivo.getRutaOrigen(), destinationPath);
            
            return ProcessedArchivo.builder()
                    .idUnico(archivo.getIdUnico())
                    .rutaOrigen(archivo.getRutaOrigen())
                    .rutaDestino(destinationPath)
                    .nombre(archivo.getNombre())
                    .status("SUCCESS")
                    .processedAt(Instant.now())
                    .build();
                    
        } catch (Exception e) {
            log.error("Failed to process file: {}", archivo.getRutaOrigen(), e);
            
            return ProcessedArchivo.builder()
                    .idUnico(archivo.getIdUnico())
                    .rutaOrigen(archivo.getRutaOrigen())
                    .rutaDestino(destinationPath)
                    .nombre(archivo.getNombre())
                    .status("FAILED")
                    .processedAt(Instant.now())
                    .errorMessage(e.getMessage())
                    .build();
        }
    }
}-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/adapter/out/persistence/mongodb/DisorganizedFilesIndexRepositoryImpl.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.adapter.out.persistence.mongodb;

import com.indra.minsait.dvsmart.reorganization.adapter.out.persistence.mongodb.entity.DisorganizedFilesIndexDocument;
import com.indra.minsait.dvsmart.reorganization.application.port.out.DisorganizedFilesIndexRepository;
import com.indra.minsait.dvsmart.reorganization.domain.model.ArchivoLegacy;
import lombok.RequiredArgsConstructor;
import org.springframework.data.mongodb.core.MongoTemplate;
import org.springframework.stereotype.Repository;
import java.util.List;
import java.util.stream.Collectors;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 13:02:04
 * File: ArchivoIndexRepositoryImpl.java
 */

@Repository
@RequiredArgsConstructor
public class DisorganizedFilesIndexRepositoryImpl implements DisorganizedFilesIndexRepository {

    private final MongoTemplate mongoTemplate;

    @Override
    public List<ArchivoLegacy> findAll() {
        return mongoTemplate.findAll(DisorganizedFilesIndexDocument.class).stream()
                .map(this::toModel)
                .collect(Collectors.toList());
    }

    @Override
    public long count() {
        return mongoTemplate.count(new org.springframework.data.mongodb.core.query.Query(), 
                                    DisorganizedFilesIndexDocument.class);
    }

    private ArchivoLegacy toModel(DisorganizedFilesIndexDocument doc) {
        return ArchivoLegacy.builder()
                .idUnico(doc.getIdUnico())
                .rutaOrigen(doc.getRutaOrigen())
                .nombre(doc.getNombre())
                .mtime(doc.getMtime())
                .build();
    }
}-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/adapter/out/persistence/mongodb/entity/DisorganizedFilesIndexDocument.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.adapter.out.persistence.mongodb.entity;

import lombok.Data;
import org.springframework.data.annotation.Id;
import org.springframework.data.mongodb.core.index.Indexed;
import org.springframework.data.mongodb.core.mapping.Document;
import java.time.Instant;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 12:59:24
 * File: ArchivoIndexDocument.java
 */

@Data
@Document(collection = "disorganized-files-index")
public class DisorganizedFilesIndexDocument {
    
    @Id
    private String id;
    
    @Indexed(unique = true)
    private String idUnico;
    
    private String rutaOrigen;
    private String nombre;
    
    // Mantiene la fecha de modificación del archivo
    private Instant mtime;
    
    // Nuevo campo: tamaño del archivo (corresponde a NumberLong en MongoDB)
    private Long tamanio;
    
    // Nuevo campo: extensión del archivo
    private String extension;
    
    // Nuevo campo: fecha en que el documento fue indexado (corresponde a Date en MongoDB)
    private Instant indexadoEn;    
}-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/adapter/out/persistence/mongodb/entity/OrganizedFilesIndexDocument.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.adapter.out.persistence.mongodb.entity;

import lombok.Builder;
import lombok.Data;
import org.springframework.data.annotation.Id;
import org.springframework.data.mongodb.core.index.Indexed;
import org.springframework.data.mongodb.core.mapping.Document;
import java.time.Instant;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 13:00:35
 * File: ProcessedFileDocument.java
 */

@Data
@Builder
@Document(collection = "organized-files-index")
public class OrganizedFilesIndexDocument {
    
    @Id
    private String id;
    
    @Indexed(unique = true)
    private String idUnico;
    
    private String rutaOrigen;
    private String rutaDestino;
    private String nombre;
    private String status;
    private Instant processedAt;
    private String errorMessage;
}
-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/adapter/out/persistence/mongodb/OrganizedFilesIndexRepositoryImpl.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.adapter.out.persistence.mongodb;

import com.indra.minsait.dvsmart.reorganization.adapter.out.persistence.mongodb.entity.OrganizedFilesIndexDocument;
import com.indra.minsait.dvsmart.reorganization.application.port.out.OrganizedFilesIndexRepository;
import com.indra.minsait.dvsmart.reorganization.domain.model.ProcessedArchivo;
import lombok.RequiredArgsConstructor;
import org.springframework.data.mongodb.core.MongoTemplate;
import org.springframework.stereotype.Repository;
import java.util.List;
import java.util.stream.Collectors;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 13:04:12
 * File: ProcessedFileAuditRepositoryImpl.java
 */

@Repository
@RequiredArgsConstructor
public class OrganizedFilesIndexRepositoryImpl implements OrganizedFilesIndexRepository {

    private final MongoTemplate mongoTemplate;

    @Override
    public void save(ProcessedArchivo archivo) {
        mongoTemplate.save(toDocument(archivo));
    }

    @Override
    public void saveAll(List<ProcessedArchivo> archivos) {
        List<OrganizedFilesIndexDocument> docs = archivos.stream()
                .map(this::toDocument)
                .collect(Collectors.toList());
        mongoTemplate.insert(docs, OrganizedFilesIndexDocument.class);
    }

    private OrganizedFilesIndexDocument toDocument(ProcessedArchivo archivo) {
        return OrganizedFilesIndexDocument.builder()
                .idUnico(archivo.getIdUnico())
                .rutaOrigen(archivo.getRutaOrigen())
                .rutaDestino(archivo.getRutaDestino())
                .nombre(archivo.getNombre())
                .status(archivo.getStatus())
                .processedAt(archivo.getProcessedAt())
                .errorMessage(archivo.getErrorMessage())
                .build();
    }
}
-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/adapter/out/sftp/SftpDestinationRepositoryImpl.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.adapter.out.sftp;

import com.indra.minsait.dvsmart.reorganization.application.port.out.SftpDestinationRepository;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.integration.sftp.session.SftpRemoteFileTemplate;
import org.springframework.stereotype.Repository;
import java.io.IOException;
import java.io.InputStream;
import org.springframework.integration.file.remote.session.Session;
import org.apache.sshd.sftp.client.SftpClient;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 13:19:47
 * File: SftpDestinationRepositoryImpl.java
 */

/**
 * Implementación compatible con Spring Integration v7+ (Apache MINA SSHD).
 * Usa session.write(InputStream, path) para streaming directo.
 * Crea directorios y escribe en la misma sesión (atómico y eficiente).
 */
@Slf4j
@Repository
public class SftpDestinationRepositoryImpl implements SftpDestinationRepository {

    private final SftpRemoteFileTemplate destinationTemplate;

    // Constructor manual con @Qualifier (correcto para Lombok)
    public SftpDestinationRepositoryImpl(@Qualifier("sftpDestinationTemplate") SftpRemoteFileTemplate destinationTemplate) {
        this.destinationTemplate = destinationTemplate;
    }

    @Override
    public void transferTo(String remotePath, InputStream inputStream) {
        try {
            destinationTemplate.execute(session -> {
                createParentDirectories(session, remotePath);
                session.write(inputStream, remotePath);
                return null;
            });
        } catch (Exception e) {
            log.error("Error transferring file to destination SFTP: {}", remotePath, e);
            throw new RuntimeException("Failed to transfer file to destination SFTP: " + remotePath, e);
        }
    }

    @Override
    public void createDirectories(String path) {
        String parentPath = path.substring(0, path.lastIndexOf('/'));
        if (!parentPath.isEmpty()) {
            try {
                destinationTemplate.execute(session -> {
                    createParentDirectories(session, parentPath);
                    return null;
                });
            } catch (Exception e) {
                log.warn("Error creating directories for path: {}", path, e);
                throw new RuntimeException("Failed to create directories on destination SFTP: " + parentPath, e);
            }
        }
    }

    private void createParentDirectories(Session<SftpClient.DirEntry> session, String remotePath) throws IOException {
        String parentPath = remotePath.substring(0, remotePath.lastIndexOf('/'));
        if (parentPath.isEmpty()) {
            return;
        }
        
        String[] dirs = parentPath.split("/");
        StringBuilder currentPath = new StringBuilder();
        
        for (String dir : dirs) {
            if (!dir.isEmpty()) {
                currentPath.append("/").append(dir);
                String cp = currentPath.toString();
                if (!session.exists(cp)) {
                    session.mkdir(cp);
                    log.debug("Created directory: {}", cp);
                }
            }
        }
    }
}-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/adapter/out/sftp/SftpOriginRepositoryImpl.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.adapter.out.sftp;

import com.indra.minsait.dvsmart.reorganization.application.port.out.SftpOriginRepository;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.integration.sftp.session.SftpRemoteFileTemplate;
import org.springframework.stereotype.Repository;
import java.io.InputStream;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 13:18:21
 * File: SftpOriginRepositoryImpl.java
 */

/**
 * Implementación usando SftpRemoteFileTemplate (compatible con Apache MINA SSHD en Spring Integration 7+).
 */
@Slf4j
@Repository
public class SftpOriginRepositoryImpl implements SftpOriginRepository {

    private final SftpRemoteFileTemplate originTemplate;

    // Constructor manual con @Qualifier (correcto para Lombok)
    public SftpOriginRepositoryImpl(@Qualifier("sftpOriginTemplate") SftpRemoteFileTemplate originTemplate) {
        this.originTemplate = originTemplate;
    }

    @Override
    public InputStream readFile(String path) {
        try {
            // readRaw retorna InputStream; finalizeRaw se llama automáticamente al cerrar el stream
            return originTemplate.execute(session -> {
                InputStream rawStream = session.readRaw(path);
                // Wrapping para asegurar finalizeRaw al cerrar el stream externo
                return new InputStream() {
                    @Override
                    public int read() throws java.io.IOException {
                        return rawStream.read();
                    }

                    @Override
                    public void close() throws java.io.IOException {
                        try {
                            rawStream.close();
                        } finally {
                            session.finalizeRaw();
                        }
                    }
                };
            });
        } catch (Exception e) {
            log.error("Error reading file from origin SFTP: {}", path, e);
            throw new RuntimeException("Failed to read file from origin SFTP: " + path, e);
        }
    }
}-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/application/port/in/StartReorganizeFullUseCase.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.application.port.in;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 12:30:07
 * File: StartReorganizeFullUseCase.java
 */

public interface StartReorganizeFullUseCase {
    Long execute();
}
-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/application/port/out/DisorganizedFilesIndexRepository.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.application.port.out;

import com.indra.minsait.dvsmart.reorganization.domain.model.ArchivoLegacy;
import java.util.List;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 12:30:42
 * File: ArchivoIndexRepository.java
 */

public interface DisorganizedFilesIndexRepository {
    List<ArchivoLegacy> findAll();
    long count();
}
-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/application/port/out/OrganizedFilesIndexRepository.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.application.port.out;

import com.indra.minsait.dvsmart.reorganization.domain.model.ProcessedArchivo;
import java.util.List;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 12:31:54
 * File: ProcessedFileAuditRepository.java
 */

public interface OrganizedFilesIndexRepository {
    void save(ProcessedArchivo archivo);
    void saveAll(List<ProcessedArchivo> archivos);
}-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/application/port/out/SftpDestinationRepository.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.application.port.out;

import java.io.InputStream;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 12:33:58
 * File: SftpDestinationRepository.java
 */

/**
 * Puerto actualizado para transferencia streaming sin exponer OutputStream.
 */
public interface SftpDestinationRepository {
    /**
     * Transfiere el contenido del InputStream al path remoto.
     * Crea directorios necesarios automáticamente.
     */
    void transferTo(String remotePath, InputStream inputStream);

    void createDirectories(String path);  // Mantenido por si se necesita separado
}
-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/application/port/out/SftpOriginRepository.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.application.port.out;

import java.io.InputStream;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 12:32:57
 * File: SftpOriginRepository.java
 */

public interface SftpOriginRepository {
	
    InputStream readFile(String path);

}
-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/application/service/StartReorganizeFullService.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.application.service;

import com.indra.minsait.dvsmart.reorganization.application.port.in.StartReorganizeFullUseCase;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.batch.core.job.Job;
import org.springframework.batch.core.job.JobExecution;
import org.springframework.batch.core.job.parameters.JobParameters;
import org.springframework.batch.core.job.parameters.JobParametersBuilder;
import org.springframework.batch.core.launch.JobOperator;
import org.springframework.stereotype.Service;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 12:54:15
 * File: StartReorganizeFullService.java
 */

@Slf4j
@Service
@RequiredArgsConstructor
public class StartReorganizeFullService implements StartReorganizeFullUseCase {

    private final JobOperator jobOperator;

    private final Job batchReorgFullJob;
    
    @Override
    public Long execute() {
        try {
            // ✅ JobParametersBuilder en lugar de Properties
            JobParameters jobParameters = new JobParametersBuilder()
                    .addLong("timestamp", System.currentTimeMillis())
                    .addString("uniqueId", java.util.UUID.randomUUID().toString())
                    .toJobParameters();  
            
            // Lanzar job usando el nombre del job (definido en BatchReorgFullConfig)
            JobExecution jobExecution = jobOperator.start(batchReorgFullJob, jobParameters);
            
            log.info("Job launched successfully. JobExecutionId: {}, Status: {}", 
                    jobExecution.getId(), jobExecution.getStatus());
            
            return jobExecution.getId();
            
        } catch (Exception e) {
            log.error("Failed to launch batch job", e);
            throw new RuntimeException("Failed to start reorganization job", e);
        }
    }
}-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/domain/model/ArchivoLegacy.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.domain.model;

import lombok.Builder;
import lombok.Data;
import java.time.Instant;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 12:26:43
 * File: ArchivoLegacy.java
 */

@Data
@Builder
public class ArchivoLegacy {
    private String idUnico;
    private String rutaOrigen;
    private String nombre;
    private Instant mtime;
}-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/domain/model/ProcessedArchivo.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.domain.model;

import lombok.Builder;
import lombok.Data;
import java.time.Instant;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 12:27:53
 * File: ProcessedArchivo.java
 */

@Data
@Builder
public class ProcessedArchivo {
    private String idUnico;
    private String rutaOrigen;
    private String rutaDestino;
    private String nombre;
    private String status;
    private Instant processedAt;
    private String errorMessage;
}
-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/domain/service/FileReorganizationService.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.domain.service;

import com.indra.minsait.dvsmart.reorganization.domain.model.ArchivoLegacy;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import java.nio.charset.StandardCharsets;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 12:28:44
 * File: FileReorganizationService.java
 */

@Slf4j
@Service
public class FileReorganizationService {

    private static final int PARTITION_DEPTH = 3;
    private static final int CHARS_PER_LEVEL = 2;

    public String calculateDestinationPath(ArchivoLegacy archivo, String baseDir) {
        String hash = generateSHA256Hash(archivo.getRutaOrigen() + archivo.getNombre());
        String partitionPath = buildPartitionPath(hash);
        return String.format("%s/%s/%s", baseDir, partitionPath, archivo.getNombre());
    }

    private String generateSHA256Hash(String input) {
        try {
            MessageDigest digest = MessageDigest.getInstance("SHA-256");
            byte[] hashBytes = digest.digest(input.getBytes(StandardCharsets.UTF_8));
            return bytesToHex(hashBytes);
        } catch (NoSuchAlgorithmException e) {
            log.error("SHA-256 algorithm not available", e);
            throw new RuntimeException("Failed to generate hash", e);
        }
    }

    private String bytesToHex(byte[] bytes) {
        StringBuilder hexString = new StringBuilder();
        for (byte b : bytes) {
            String hex = Integer.toHexString(0xff & b);
            if (hex.length() == 1) {
                hexString.append('0');
            }
            hexString.append(hex);
        }
        return hexString.toString();
    }

    private String buildPartitionPath(String hash) {
        StringBuilder path = new StringBuilder();
        for (int i = 0; i < PARTITION_DEPTH; i++) {
            int start = i * CHARS_PER_LEVEL;
            int end = Math.min(start + CHARS_PER_LEVEL, hash.length());
            if (i > 0) {
                path.append('/');
            }
            path.append(hash.substring(start, end));
        }
        return path.toString();
    }
}
-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/infrastructure/config/BatchConfigProperties.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.infrastructure.config;

import lombok.Getter;
import lombok.Setter;
import org.springframework.boot.context.properties.ConfigurationProperties;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 12:25:45
 * File: BatchConfigProperties.java
 */

@Getter
@Setter
@ConfigurationProperties(prefix = "batch")
public class BatchConfigProperties {
    private int chunkSize = 100;
    private int concurrencyLimit = 10;
    private int threadPoolSize = 20;
    private int queueCapacity = 1000;
}
-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/infrastructure/config/MongoConfigProperties.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.infrastructure.config;

import org.springframework.boot.context.properties.ConfigurationProperties;

import lombok.Getter;
import lombok.Setter;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 15-12-2025 at 20:27:03
 * File: MongoConfigProperties.java
 */

@Getter
@Setter
@ConfigurationProperties(prefix = "mongo")
public class MongoConfigProperties {
	private String disorganizedFilesIndex = "disorganized-files-index";
}
-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/infrastructure/config/SftpConfigProperties.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.infrastructure.config;

import lombok.Getter;
import lombok.Setter;
import org.springframework.boot.context.properties.ConfigurationProperties;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 11:03:22
 * File: SftpConfigProperties.java
 */

@Getter
@Setter
@ConfigurationProperties(prefix = "sftp")
public class SftpConfigProperties {
    
    private Origin origin = new Origin();
    private Destination dest = new Destination();
    
    @Getter
    @Setter
    public static class Origin {
        private String host;
        private int port = 22;
        private String user;
        private String password;
        private String baseDir;
        private Pool pool = new Pool();
        private int timeout = 30000;
    }
    
    @Getter
    @Setter
    public static class Destination {
        private String host;
        private int port = 22;
        private String user;
        private String password;
        private String baseDir;
        private Pool pool = new Pool();
        private int timeout = 30000;
    }
    
    @Getter
    @Setter
    public static class Pool {
        private int size = 10;
    }
}
-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/infrastructure/exception/GlobalExceptionHandler.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.infrastructure.exception;

import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import java.time.Instant;
import java.util.Map;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 13:26:24
 * File: GlobalExceptionHandler.java
 */

@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(RuntimeException.class)
    public ResponseEntity<Map<String, Object>> handleRuntimeException(RuntimeException ex) {
        log.error("Runtime exception occurred", ex);
        
        return ResponseEntity
                .status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(Map.of(
                    "timestamp", Instant.now().toString(),
                    "status", HttpStatus.INTERNAL_SERVER_ERROR.value(),
                    "error", "Internal Server Error",
                    "message", ex.getMessage() != null ? ex.getMessage() : "An unexpected error occurred"
                ));
    }

    @ExceptionHandler(IllegalArgumentException.class)
    public ResponseEntity<Map<String, Object>> handleIllegalArgumentException(IllegalArgumentException ex) {
        log.error("Illegal argument exception occurred", ex);
        
        return ResponseEntity
                .status(HttpStatus.BAD_REQUEST)
                .body(Map.of(
                    "timestamp", Instant.now().toString(),
                    "status", HttpStatus.BAD_REQUEST.value(),
                    "error", "Bad Request",
                    "message", ex.getMessage() != null ? ex.getMessage() : "Invalid request parameters"
                ));
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<Map<String, Object>> handleGenericException(Exception ex) {
        log.error("Unexpected exception occurred", ex);
        
        return ResponseEntity
                .status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(Map.of(
                    "timestamp", Instant.now().toString(),
                    "status", HttpStatus.INTERNAL_SERVER_ERROR.value(),
                    "error", "Internal Server Error",
                    "message", "An unexpected error occurred"
                ));
    }
}
-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/infrastructure/sftp/SftpSessionFactoryConfig.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization.infrastructure.sftp;

import com.indra.minsait.dvsmart.reorganization.infrastructure.config.SftpConfigProperties;
import lombok.RequiredArgsConstructor;
import org.apache.sshd.sftp.client.SftpClient;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.integration.file.remote.session.CachingSessionFactory;
import org.springframework.integration.file.remote.session.SessionFactory;
import org.springframework.integration.sftp.session.DefaultSftpSessionFactory;
import org.springframework.integration.sftp.session.SftpRemoteFileTemplate;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 12-12-2025 at 13:05:17
 * File: SftpSessionFactoryConfig.java
 */

@Configuration
@RequiredArgsConstructor
public class SftpSessionFactoryConfig {

    private final SftpConfigProperties props;

    @Bean(name = "sftpOriginSessionFactory")
    SessionFactory<SftpClient.DirEntry> sftpOriginSessionFactory() {
        DefaultSftpSessionFactory factory = new DefaultSftpSessionFactory(true);
        factory.setHost(props.getOrigin().getHost());
        factory.setPort(props.getOrigin().getPort());
        factory.setUser(props.getOrigin().getUser());
        factory.setPassword(props.getOrigin().getPassword());
        factory.setTimeout(props.getOrigin().getTimeout());
        factory.setAllowUnknownKeys(true);

        CachingSessionFactory<SftpClient.DirEntry> cachingFactory = new CachingSessionFactory<>(factory);
        cachingFactory.setPoolSize(props.getOrigin().getPool().getSize());

        return cachingFactory;
    }

    @Bean(name = "sftpDestinationSessionFactory")
    SessionFactory<SftpClient.DirEntry> sftpDestinationSessionFactory() {
        DefaultSftpSessionFactory factory = new DefaultSftpSessionFactory(true);
        factory.setHost(props.getDest().getHost());
        factory.setPort(props.getDest().getPort());
        factory.setUser(props.getDest().getUser());
        factory.setPassword(props.getDest().getPassword());
        factory.setTimeout(props.getDest().getTimeout());
        factory.setAllowUnknownKeys(true);

        CachingSessionFactory<SftpClient.DirEntry> cachingFactory = new CachingSessionFactory<>(factory);
        cachingFactory.setPoolSize(props.getDest().getPool().getSize());

        return cachingFactory;
    }

    @Bean(name = "sftpOriginTemplate")
    SftpRemoteFileTemplate sftpOriginTemplate() {
        return new SftpRemoteFileTemplate(sftpOriginSessionFactory());
    }

    @Bean(name = "sftpDestinationTemplate")
    SftpRemoteFileTemplate sftpDestinationTemplate() {
        return new SftpRemoteFileTemplate(sftpDestinationSessionFactory());
    }
}-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/java/com/indra/minsait/dvsmart/reorganization/ServiceApplication.java
════════════════════════════════════════════════
/*
 * /////////////////////////////////////////////////////////////////////////////
 *
 * Copyright (c) 2025 Indra Sistemas, S.A. All Rights Reserved.
 * http://www.indracompany.com/
 *
 * The contents of this file are owned by Indra Sistemas, S.A. copyright holder.
 * This file can only be copied, distributed and used all or in part with the
 * written permission of Indra Sistemas, S.A, or in accordance with the terms and
 * conditions laid down in the agreement / contract under which supplied.
 *
 * /////////////////////////////////////////////////////////////////////////////
 */
package com.indra.minsait.dvsmart.reorganization;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.context.properties.ConfigurationPropertiesScan;

/**
 * Author: hahuaranga@indracompany.com
 * Created on: 11-12-2025 at 17:07:25
 * File: ServiceApplication.java
 */

@SpringBootApplication
@ConfigurationPropertiesScan
public class ServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(ServiceApplication.class, args);
    }
}
-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./src/main/resources/application.properties
════════════════════════════════════════════════
# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================
spring.application.name=dvsmart-reorganization-api
server.servlet.context-path=/dvsmart-reorganization-api
server.port=8080

# ============================================================================
# MONGODB CONFIGURATION
# ============================================================================
spring.mongodb.uri=mongodb://localhost:27017/dvsmart_reorganization

mongo.disorganized-files-index=disorganized-files-index

# ============================================================================
# SPRING BATCH CONFIGURATION
# ============================================================================
# Deshabilitar inicio automatico de jobs al arrancar la aplicacion
spring.batch.job.enabled=false

# ============================================================================
# BATCH CUSTOM PROPERTIES (BatchConfigProperties)
# ============================================================================
# Tamaño del chunk para procesamiento por lotes
# Cada chunk procesa este numero de registros antes de commit
batch.chunk-size=100

# Limite de concurrencia (deprecado, usar thread-pool-size)
batch.concurrency-limit=10

# Tamaño del pool de threads para procesamiento asincrono
# Mas threads = mas procesamiento paralelo (balance con recursos del servidor)
batch.thread-pool-size=20

# Capacidad de la cola de tareas pendientes
# Si hay mas tareas que threads, se encolan aqui
batch.queue-capacity=1000

# ============================================================================
# SFTP ORIGIN CONFIGURATION (SftpConfigProperties.Origin)
# ============================================================================
# Servidor SFTP de origen (donde estan los archivos actuales)
sftp.origin.host=sftp-origin.example.com
sftp.origin.port=22
sftp.origin.user=origin_user
sftp.origin.password=origin_password

# Directorio base en el servidor origen
sftp.origin.base-dir=/data/legacy/files

# Timeout de conexion en milisegundos (30 segundos)
sftp.origin.timeout=30000

# Tamaño del pool de conexiones SFTP origen
# Mas conexiones = mas operaciones simultaneas de lectura
sftp.origin.pool.size=10

# ============================================================================
# SFTP DESTINATION CONFIGURATION (SftpConfigProperties.Destination)
# ============================================================================
# Servidor SFTP de destino (donde se reorganizaran los archivos)
sftp.dest.host=sftp-destination.example.com
sftp.dest.port=22
sftp.dest.user=dest_user
sftp.dest.password=dest_password

# Directorio base en el servidor destino
# Los archivos se crearan bajo: {base-dir}/{hash-partition}/{filename}
# Ejemplo: /data/reorganized/a1/b2/c3/archivo.txt
sftp.dest.base-dir=/data/reorganized

# Timeout de conexion en milisegundos (30 segundos)
sftp.dest.timeout=30000

# Tamaño del pool de conexiones SFTP destino
# Mas conexiones = mas operaciones simultaneas de escritura
sftp.dest.pool.size=10

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
# Nivel de log general
logging.level.root=INFO

# Logs de la aplicacion (ajustar segun necesidad)
logging.level.com.indra.minsait.dvsmart.reorganization=DEBUG

# Logs de Spring Batch (INFO para produccion, DEBUG para desarrollo)
logging.level.org.springframework.batch=INFO

# Logs de Spring Integration SFTP (DEBUG para troubleshooting)
logging.level.org.springframework.integration.sftp=DEBUG

# Logs de MongoDB
logging.level.org.springframework.data.mongodb=INFO

# Patron de log para consola
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg%n

# Patron de log para archivo
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# Configuracion de archivo de log
logging.file.name=logs/reorganization.log
logging.file.max-size=10MB
logging.file.max-history=30
logging.file.total-size-cap=500MB

# ============================================================================
# ACTUATOR CONFIGURATION (Monitoring & Health)
# ============================================================================
# Exponer endpoints de actuator
management.endpoints.web.exposure.include=health,info,metrics,batch

# Mostrar detalles del health check
management.endpoint.health.show-details=always

# Habilitar metricas de JVM, proceso y sistema
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./target/classes/application.properties
════════════════════════════════════════════════
# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================
spring.application.name=dvsmart-reorganization-api
server.servlet.context-path=/dvsmart-reorganization-api
server.port=8080

# ============================================================================
# MONGODB CONFIGURATION
# ============================================================================
spring.mongodb.uri=mongodb://localhost:27017/dvsmart_reorganization

mongo.disorganized-files-index=disorganized-files-index

# ============================================================================
# SPRING BATCH CONFIGURATION
# ============================================================================
# Deshabilitar inicio automatico de jobs al arrancar la aplicacion
spring.batch.job.enabled=false

# ============================================================================
# BATCH CUSTOM PROPERTIES (BatchConfigProperties)
# ============================================================================
# Tamaño del chunk para procesamiento por lotes
# Cada chunk procesa este numero de registros antes de commit
batch.chunk-size=100

# Limite de concurrencia (deprecado, usar thread-pool-size)
batch.concurrency-limit=10

# Tamaño del pool de threads para procesamiento asincrono
# Mas threads = mas procesamiento paralelo (balance con recursos del servidor)
batch.thread-pool-size=20

# Capacidad de la cola de tareas pendientes
# Si hay mas tareas que threads, se encolan aqui
batch.queue-capacity=1000

# ============================================================================
# SFTP ORIGIN CONFIGURATION (SftpConfigProperties.Origin)
# ============================================================================
# Servidor SFTP de origen (donde estan los archivos actuales)
sftp.origin.host=sftp-origin.example.com
sftp.origin.port=22
sftp.origin.user=origin_user
sftp.origin.password=origin_password

# Directorio base en el servidor origen
sftp.origin.base-dir=/data/legacy/files

# Timeout de conexion en milisegundos (30 segundos)
sftp.origin.timeout=30000

# Tamaño del pool de conexiones SFTP origen
# Mas conexiones = mas operaciones simultaneas de lectura
sftp.origin.pool.size=10

# ============================================================================
# SFTP DESTINATION CONFIGURATION (SftpConfigProperties.Destination)
# ============================================================================
# Servidor SFTP de destino (donde se reorganizaran los archivos)
sftp.dest.host=sftp-destination.example.com
sftp.dest.port=22
sftp.dest.user=dest_user
sftp.dest.password=dest_password

# Directorio base en el servidor destino
# Los archivos se crearan bajo: {base-dir}/{hash-partition}/{filename}
# Ejemplo: /data/reorganized/a1/b2/c3/archivo.txt
sftp.dest.base-dir=/data/reorganized

# Timeout de conexion en milisegundos (30 segundos)
sftp.dest.timeout=30000

# Tamaño del pool de conexiones SFTP destino
# Mas conexiones = mas operaciones simultaneas de escritura
sftp.dest.pool.size=10

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
# Nivel de log general
logging.level.root=INFO

# Logs de la aplicacion (ajustar segun necesidad)
logging.level.com.indra.minsait.dvsmart.reorganization=DEBUG

# Logs de Spring Batch (INFO para produccion, DEBUG para desarrollo)
logging.level.org.springframework.batch=INFO

# Logs de Spring Integration SFTP (DEBUG para troubleshooting)
logging.level.org.springframework.integration.sftp=DEBUG

# Logs de MongoDB
logging.level.org.springframework.data.mongodb=INFO

# Patron de log para consola
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg%n

# Patron de log para archivo
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# Configuracion de archivo de log
logging.file.name=logs/reorganization.log
logging.file.max-size=10MB
logging.file.max-history=30
logging.file.total-size-cap=500MB

# ============================================================================
# ACTUATOR CONFIGURATION (Monitoring & Health)
# ============================================================================
# Exponer endpoints de actuator
management.endpoints.web.exposure.include=health,info,metrics,batch

# Mostrar detalles del health check
management.endpoint.health.show-details=always

# Habilitar metricas de JVM, proceso y sistema
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./target/classes/META-INF/maven/com.indra.minsait.dvsmart.reorganization/dvsmart_reorganization_api/pom.properties
════════════════════════════════════════════════
#Generated by Maven Integration for Eclipse
#Fri Dec 19 19:16:16 CLST 2025
artifactId=dvsmart_reorganization_api
groupId=com.indra.minsait.dvsmart.reorganization
m2e.projectLocation=D\:\\WORKSPACES\\workspace_eclipse_new_latest\\dvsmart_reorganization_api
m2e.projectName=dvsmart_reorganization_api
version=1.0.1-SNAPSHOT
-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./target/classes/META-INF/maven/com.indra.minsait.dvsmart.reorganization/dvsmart_reorganization_api/pom.xml
════════════════════════════════════════════════
<project xmlns="http://maven.apache.org/POM/4.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>4.0.0</version>
	</parent>
	<groupId>com.indra.minsait.dvsmart.reorganization</groupId>
	<artifactId>dvsmart_reorganization_api</artifactId>
	<version>1.0.1-SNAPSHOT</version>
	<name>dvsmart_reorganization_api</name>
	<properties>
		<java.version>21</java.version>
		<maven.compiler.source>21</maven.compiler.source>
		<maven.compiler.target>21</maven.compiler.target>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>

		<license.maven.plugin.version>5.0.0</license.maven.plugin.version>
		<maven.build.timestamp.format>yyyy</maven.build.timestamp.format>

		<spring-batch.version>6.0.0</spring-batch.version>
		<spring-integration.version>7.0.0</spring-integration.version>

		<!-- Other dependencies -->
		<lombok.version>1.18.30</lombok.version>
		<sshj.version>0.38.0</sshj.version>
	</properties>

	<dependencies>
		<!-- Spring Boot Starters -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-data-mongodb</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-actuator</artifactId>
		</dependency>

		<!-- Spring Batch -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-batch</artifactId>
		</dependency>

		<!-- Spring Integration Core -->
		<dependency>
			<groupId>org.springframework.integration</groupId>
			<artifactId>spring-integration-core</artifactId>
		</dependency>

		<!-- Spring Integration SFTP (SSHJ) -->
		<dependency>
			<groupId>org.springframework.integration</groupId>
			<artifactId>spring-integration-sftp</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework.batch</groupId>
			<artifactId>spring-batch-integration</artifactId>
		</dependency>

		<!-- SSHJ for SFTP -->
		<dependency>
			<groupId>com.hierynomus</groupId>
			<artifactId>sshj</artifactId>
			<version>${sshj.version}</version>
		</dependency>

		<!-- Lombok -->
		<dependency>
			<groupId>org.projectlombok</groupId>
			<artifactId>lombok</artifactId>
			<scope>provided</scope>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-devtools</artifactId>
			<scope>runtime</scope>
			<optional>true</optional>
		</dependency>

		<!-- Spring Boot Configuration Processor -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-configuration-processor</artifactId>
			<optional>true</optional>
		</dependency>
		
		<dependency>
		    <groupId>com.h2database</groupId>
		    <artifactId>h2</artifactId>
		    <scope>runtime</scope>
		</dependency>		

		<!-- Testing -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>

		<dependency>
			<groupId>org.springframework.batch</groupId>
			<artifactId>spring-batch-test</artifactId>
			<scope>test</scope>
		</dependency>

		<dependency>
			<groupId>org.springframework.integration</groupId>
			<artifactId>spring-integration-test</artifactId>
			<scope>test</scope>
		</dependency>
	</dependencies>

	<build>
		<finalName>${project.artifactId}</finalName>
		<plugins>

			<!-- Maven Compiler Plugin -->
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-compiler-plugin</artifactId>
				<configuration>
					<source>${java.version}</source>
					<target>${java.version}</target>
					<encoding>${project.build.sourceEncoding}</encoding>
					<annotationProcessorPaths>
						<path>
							<groupId>org.projectlombok</groupId>
							<artifactId>lombok</artifactId>
							<version>${lombok.version}</version>
						</path>
						<path>
							<groupId>org.springframework.boot</groupId>
							<artifactId>spring-boot-configuration-processor</artifactId>
							<version>4.0.0</version>
						</path>
					</annotationProcessorPaths>
				</configuration>
			</plugin>

			<!-- Spring Boot Maven Plugin -->
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
				<configuration>
					<excludes>
						<exclude>
							<groupId>org.projectlombok</groupId>
							<artifactId>lombok</artifactId>
						</exclude>
					</excludes>
				</configuration>
				<executions>
					<execution>
						<goals>
							<goal>repackage</goal>
						</goals>
					</execution>
				</executions>
			</plugin>

			<!-- CopyRight Plugin -->
			<plugin>
				<groupId>com.mycila</groupId>
				<artifactId>license-maven-plugin</artifactId>
				<version>${license.maven.plugin.version}</version>
				<configuration>
					<!-- Ruta del banner -->
					<header>src/main/resources/license-header.txt</header>

					<!-- Aplicar solo a archivos donde corresponde -->
					<includes>
						<include>**/*.java</include>
					</includes>

					<!-- Evitar modificar código generado o configuraciones -->
					<excludes>
						<exclude>**/target/**</exclude>
						<exclude>**/generated/**</exclude>
					</excludes>

					<!-- Variables dinámicas -->
					<properties>
						<year>${maven.build.timestamp}</year>
					</properties>

					<!-- Etiquetas conocidas para insertar correctamente el
					header -->
					<mapping>
						<java>SLASHSTAR_STYLE</java>
					</mapping>

					<!-- Configuraciones adicionales importantes -->
					<strictCheck>true</strictCheck>
					<useDefaultExcludes>true</useDefaultExcludes>
				</configuration>

				<executions>
					<!-- Ejecuta el format en la fase process-sources (antes de
					compile) -->
					<execution>
						<id>apply-license-headers</id>
						<phase>process-sources</phase>
						<goals>
							<goal>format</goal>
						</goals>
					</execution>
				</executions>
			</plugin>

			<!-- Maven Surefire Plugin (para tests) -->
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-surefire-plugin</artifactId>
				<!--				<version>3.0.0</version>-->
				<configuration>
					<includes>
						<include>**/*Test.java</include>
						<include>**/*Tests.java</include>
					</includes>
				</configuration>
			</plugin>

			<!-- Maven Resources Plugin -->
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-resources-plugin</artifactId>
				<!--				<version>3.3.1</version>-->
				<configuration>
					<encoding>${project.build.sourceEncoding}</encoding>
				</configuration>
			</plugin>
		</plugins>
	</build>

	<!-- Profiles -->
	<profiles>
		<!-- Development Profile -->
		<profile>
			<id>dev</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<properties>
				<spring.profiles.active>dev</spring.profiles.active>
			</properties>
		</profile>

		<!-- Production Profile -->
		<profile>
			<id>prod</id>
			<properties>
				<spring.profiles.active>prod</spring.profiles.active>
			</properties>
		</profile>
	</profiles>
</project>-e /n/n
════════════════════════════════════════════════
ARCHIVO: ./target/maven-archiver/pom.properties
════════════════════════════════════════════════
artifactId=dvsmart_reorganization_api
groupId=com.indra.minsait.dvsmart.reorganization
version=1.0.1-SNAPSHOT
-e /n/n
